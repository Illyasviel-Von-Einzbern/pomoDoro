import{a2 as S,r as c,a4 as L,Q as V,R as f,S as D,T as l,c as b,U as A,W as K,a as u,Y as i,Z as w,a5 as F,a0 as h,F as N,$ as O,a6 as M}from"./index-CvL_9HmI.js";import{o as z}from"./index-Dob3nYDb.js";const T={class:"upload-btn"},W={key:0,style:{color:"red"}},E={key:1},I=["onClick"],Q=["onClick"],Y={key:2},Z=["src"],q=["src"],G={__name:"test",setup(H){const r=c([]),m=c(""),d=c(null),o=c(null),k=c(!0),x=async()=>{d.value=await z("AlarmDB",1,{upgrade(t){t.objectStoreNames.contains("media")||t.createObjectStore("media")}})},g=async()=>{const e=d.value.transaction("media","readonly").objectStore("media"),a=await e.getAllKeys(),s=[];for(const p of a){const v=await e.get(p);s.push(v)}r.value=s},B=async t=>{const a=Array.from(t.target.files).filter(n=>n.type==="audio/mpeg"||n.type==="video/mp4");if(a.length===0){m.value="只能上傳 mp3 或 mp4 檔案。";return}const s=d.value.transaction("media","readwrite"),p=s.objectStore("media"),v=await p.getAllKeys();for(let n of a){let y=n.name;if(v.includes(y)){const j=Date.now(),R=n.name.split(".").pop();y=`${n.name.replace(/\.[^/.]+$/,"")}_${j}.${R}`}const _=new File([n],y,{type:n.type});await p.put(_,_.name),r.value.push(_)}await s.done},C=t=>{o.value&&URL.revokeObjectURL(o.value),o.value=URL.createObjectURL(t),k.value=t.type.startsWith("audio")},U=async t=>{const e=d.value.transaction("media","readwrite");await e.objectStore("media").delete(t),await e.done,r.value=r.value.filter(s=>s.name!==t),o.value&&(URL.revokeObjectURL(o.value),o.value=null)},$=t=>{const e=t/1024;return e>1024?`${(e/1024).toFixed(4)} MB`:`${e.toFixed(4)} KB`};return L(async()=>{await x(),await g()}),(t,e)=>(l(),V(D,null,{default:f(()=>[b(A,null,{default:f(()=>[b(K,{cols:"12"},{default:f(()=>[u("label",T,[e[0]||(e[0]=F(" 上傳鈴聲 ")),u("input",{accept:".mp3, .mp4",hidden:"",multiple:"",type:"file",onChange:B},null,32)]),m.value?(l(),i("p",W,h(m.value),1)):w("",!0),r.value.length>0?(l(),i("ul",E,[(l(!0),i(N,null,O(r.value,a=>(l(),i("li",{key:a.name},[u("a",{href:"#",onClick:M(s=>C(a),["prevent"])},h(a.name),9,I),F(" ("+h($(a.size))+") ",1),u("button",{onClick:s=>U(a.name)},"🗑 刪除",8,Q)]))),128))])):w("",!0),o.value?(l(),i("div",Y,[e[1]||(e[1]=u("p",null,"正在預覽：",-1)),k.value?(l(),i("audio",{key:0,autoplay:"",controls:"",src:o.value},null,8,Z)):(l(),i("video",{key:1,autoplay:"",controls:"",src:o.value,width:"300"},null,8,q))])):w("",!0)]),_:1})]),_:1})]),_:1}))}},ee=S(G,[["__scopeId","data-v-651b0458"]]);export{ee as default};
