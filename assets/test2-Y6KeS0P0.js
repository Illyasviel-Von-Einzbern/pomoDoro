import{o as U}from"./index-Dob3nYDb.js";import{a2 as j,a3 as A,r as b,a4 as L,Q as D,R as d,S as N,T as f,c as r,U as $,W as w,a,Y as y,F as K,$ as O,_ as v,a0 as V,Z as h,a1 as T,a5 as I}from"./index-88BeCIkd.js";import{d as E}from"./forwardRefs-mZDv5K0_.js";import{V as G,a as M}from"./VRadioGroup-oBy_e5EN.js";const Q=["src"],W=["onClick"],Y={class:"upload-btn"},Z={key:0,style:{color:"red"}},q={__name:"test2",setup(z){const o=A(),p=b(""),c=b(null),g=async()=>{c.value=await U("AlarmDB",1,{upgrade(e){e.objectStoreNames.contains("media")||e.createObjectStore("media")}})},k=async()=>{const t=c.value.transaction("media","readonly").objectStore("media"),l=await t.getAllKeys(),n=[];for(const i of l){const s=await t.get(i),u=URL.createObjectURL(s);n.push({id:s.name,name:s.name,file:u})}const _=new Set(o.alarms.map(i=>i.id));for(const i of n)_.has(i.id)||o.alarms.push(i)},x=async e=>{const l=Array.from(e.target.files).filter(s=>s.type==="audio/mpeg"||s.type==="video/mp4");if(l.length===0){p.value="只能上傳 mp3 或 mp4 檔案。";return}const n=c.value.transaction("media","readwrite"),_=n.objectStore("media"),i=await _.getAllKeys();for(let s of l){let u=s.name;if(i.includes(u)){const S=Date.now(),B=s.name.split(".").pop();u=`${s.name.replace(/\.[^/.]+$/,"")}_${S}.${B}`}const m=new File([s],u,{type:s.type});await _.put(m,m.name);const R=URL.createObjectURL(m);o.alarms.push({id:m.name,name:m.name,default:!1,file:R})}await n.done},C=e=>!e.default,F=async e=>{if(!(!c.value||!(e!=null&&e.id)))try{const t=c.value.transaction("media","readwrite");await t.objectStore("media").delete(e.id),await t.done,e.file&&URL.revokeObjectURL(e.file),o.alarms=o.alarms.filter(n=>n.id!==e.id),o.selected===e.id&&(o.selected=null)}catch(t){console.error("刪除失敗:",t),p.value="刪除失敗，請稍後再試。"}};return L(async()=>{await g(),await k()}),(e,t)=>(f(),D(N,null,{default:d(()=>[r($,null,{default:d(()=>[r(w,{cols:"12"},{default:d(()=>t[1]||(t[1]=[a("h1",{class:"text-center"},"鈴聲設定",-1)])),_:1,__:[1]}),r(w,{cols:"12"},{default:d(()=>[r(E,null,{default:d(()=>[t[2]||(t[2]=a("thead",null,[a("tr",null,[a("th",null,"名稱"),a("th",null,"試聽"),a("th",null,"選擇"),a("th",null,"刪除")])],-1)),a("tbody",null,[(f(!0),y(K,null,O(v(o).alarms,l=>(f(),y("tr",{key:l.id},[a("td",null,V(l.name),1),a("td",null,[a("audio",{controls:"",src:l.file},null,8,Q)]),a("td",null,[r(G,{modelValue:v(o).selected,"onUpdate:modelValue":t[0]||(t[0]=n=>v(o).selected=n),"hide-details":""},{default:d(()=>[r(M,{value:l.id},null,8,["value"])]),_:2},1032,["modelValue"])]),a("td",null,[C(l)?(f(),y("button",{key:0,title:"刪除",onClick:n=>F(l)},[r(T,{icon:"mdi-delete",onClick:e.addAlarms},null,8,["onClick"])],8,W)):h("",!0)])]))),128))])]),_:1,__:[2]})]),_:1}),r(w,{cols:"12"},{default:d(()=>[a("label",Y,[t[3]||(t[3]=I(" ＋ ")),a("input",{accept:".mp3, .mp4",hidden:"",multiple:"",type:"file",onChange:x},null,32)]),p.value?(f(),y("p",Z,V(p.value),1)):h("",!0)]),_:1})]),_:1})]),_:1}))}},te=j(q,[["__scopeId","data-v-f5ed3dae"]]);export{te as default};
